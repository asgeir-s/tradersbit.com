<md-toolbar>
  <div class="md-toolbar-tools">
    <h2>Subscribe to Stream (sandbox mode)</h2>
    <span flex></span>
    <md-button class="md-icon-button" ng-click="ctrl.cancel()">
      <md-icon class="material-icons" aria-label="Close dialog">close</md-icon>
    </md-button>
  </div>
</md-toolbar>
<md-dialog-content>
  <div class="md-dialog-content">

    <div ng-hide="ctrl.gotPaymentInfo">
      <small>price for 30 days subscription</small>
      <br/>
      <h3 class="md-display-1">{{ctrl.inStream.subscriptionPriceUSD | currency:"$"}}</h3>
      <small>≈ ฿{{ctrl.fullPriceUSD / ctrl.inBtcRate | number:4}}</small>
    </div>

    <div ng-hide="ctrl.gotPaymentInfo">
      <p>
        In the test period we use the Bitcoin Testnet (not real bitcoins). You can use a Coinbase sandbox account to "pay" subscription
        fees. Create a sandbox account <a href="https://sandbox.coinbase.com/signup" target="_blank">here</a>.
      </p>
      <p>
        By subscribing to this stream, you will get new trading signals sent to your email and/or automatically traded at
        <span style="text-transform: capitalize;">{{ctrl.inStream.exchange}}</span> on your behalf.
      </p>
      <p>
        If you include your email, you get an email with the option to continue the subscription seven days before the subscription
        expires.
      </p>
      <p>
        If you later want to change the email or API keys, you have to buy a new subscription.
      </p>
    </div>

    <form novalidate name="subscribeForm" ng-hide="ctrl.gotPaymentInfo || ctrl.waitForResponds">
      <div layout="column" layout-align="center">
        <md-switch class="md-primary signals-to-email" ng-model="ctrl.subscription.signalsToEmail" ng-disabled="true" aria-label="Subscribe with Email">
          Send new signals to email
        </md-switch>
        <md-input-container flex>
          <label for="email">Email (optional if you use Autotrader)</label>
          <input ng-required='ctrl.subscription.signalsToEmail' type="email" ng-model="ctrl.subscription.email" id="email" value=""
          />
        </md-input-container>
        <md-switch class="md-primary" ng-disabled="true" ng-model="ctrl.subscribeAutoTrader" aria-label="Switch 6" ng-change="ctrl.updatePrice()">
          Autotrader ({{ctrl.autoTraderPrice | currency:"$"}} ≈ ฿{{ctrl.autoTraderPrice / ctrl.inBtcRate | number:4}})
        </md-switch>
        <md-input-container flex ng-hide="!ctrl.subscribeAutoTrader">
          <label>API key for <span style="text-transform: capitalize;">{{ctrl.inStream.exchange}}</span></label>
          <input name="apiKey" ng-required='ctrl.subscribeAutoTrader' ng-disabled="!ctrl.subscribeAutoTrader" type="text" ng-model="ctrl.subscription.apiKey"
          ng-minlength="5" />
        </md-input-container>
        <md-input-container flex ng-hide="!ctrl.subscribeAutoTrader">
          <label>API secret for <span style="text-transform: capitalize;">{{ctrl.inStream.exchange}}</span></label>
          <input name="apiSecret" ng-required='ctrl.subscribeAutoTrader' ng-disabled="!ctrl.subscribeAutoTrader" type="text" ng-model="ctrl.subscription.apiSecret"
          ng-minlength="5" />
        </md-input-container>

        <div flex class="recaptcha" vc-recaptcha key="'6Lek2xETAAAAANo7-PKjcbAn8OuxJytZ4IQwLmFg'" on-success="ctrl.setReCaptchaResponds(response)"></div>

        <md-button flex ng-hide="ctrl.waitForResponds" ng-disabled="!ctrl.subscription.signalsToEmail && !ctrl.subscribeAutoTrader || !subscribeForm.$valid"
        class="md-raised md-accent btc-pay-button" type="submit" ng-click="ctrl.postSubscriptionReturnButtonCode(ctrl.subscription)"
        value="Submit" style="margin:0">Pay with Bitcoin</md-button>

      </div>
    </form>

    <md-progress-circular class="waiting" md-mode="indeterminate" ng-hide="!ctrl.waitForResponds" md-diameter="100"></md-progress-circular>

    <iframe ng-show="ctrl.gotPaymentInfo" id="coinbase_inline_iframe_{{ctrl.coinbaseEmbedCode}}" ng-src="{{ctrl.trustSrc('https://sandbox.coinbase.com/checkouts/' + ctrl.coinbaseEmbedCode + '/inline')}}"
    style="width: 100%; height: 450px; border: none;" allowtransparency="true" frameborder="0"></iframe>

  </div>
</md-dialog-content>